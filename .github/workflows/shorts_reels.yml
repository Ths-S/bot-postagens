name: Upload YouTube Video

on:
  workflow_dispatch:
  push:
    paths:
      - "videos/pending/**"
      - "upload_youtube.py"
      - "tests/**"

jobs:
  test-and-upload:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repositório
        uses: actions/checkout@v3

      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Instalar dependências
        run: |
          pip install google-auth google-auth-oauthlib google-auth-httplib2 google-api-python-client pytest

      - name: Rodar testes
        run: pytest -v

      - name: Rodar upload (se testes passarem)
        if: success()
        env:
          YOUTUBE_CLIENT_SECRET_JSON: ${{ secrets.YOUTUBE_CLIENT_SECRET_JSON }}
          YOUTUBE_TOKEN_PICKLE: ${{ secrets.YOUTUBE_TOKEN_PICKLE }}
        run: python upload_youtube.py
